{include file="admintemplate/header.htm"}	
<script type="text/javascript">
$(document).ready(function(){
	var editor1;
	KindEditor.ready(function(K) {
			editor1 = K.create('textarea[name="articlecontent"]', {
			cssPath : './public/kindeditor/plugins/code/prettify.css',
			uploadJson : './public/kindeditor/php/upload_json.php',
			fileManagerJson : './public/kindeditor/php/file_manager_json.php',
			allowFileManager : true,
		});
		prettyPrint();
	});
	$("#addArticle").click(function(){
		$("#dis1").hide();
		$("#dis2").show();
		$.post("index.php?mod=article&act=getcolumns",
				function(data){
					var myjson='';
			        eval('myjson=' + data + ';');
			        var html='';
			        for(i=0;i<myjson.length;i++){
			        	html+="<option value='"+myjson[i]['column_id']+"'>———"+myjson[i]['column_name']+"———</option>";
			        }
					$("#column").html(html);
					var test = "{$columnid}";
					if(test == ""){
						$("#column option[value='{$columnpid}']").attr("selected","selected");
					} else {
						$("#column option[value='{$columnid}']").attr("selected","selected");
					}
		});
	});
	$("a[service='updateArticle']").click(function(){
// 		alert($("#editarticle").val());
		$("#dis1").hide();
		$("#dis2").show();
		$("#formtitle").html("修改文章");
		$("#uparticle-btn").attr("value", "修改");
		$("#formcontent").attr("action", "index.php?mod=article&act=modifyarticle&articleid=" + $(this).attr("id"));
		$.post("index.php?mod=article&act=getcolumns",
			function(data){
				var myjson='';
		        eval('myjson=' + data + ';');
		        var html='';
		        for(i=0;i<myjson.length;i++){
		        	html+="<option value='"+myjson[i]['column_id']+"'>———"+myjson[i]['column_name']+"———</option>";
		        }
				$("#column").html(html);
		});
		$.post("index.php?mod=article&act=updateArticle&articleid=" + $(this).attr("id"),
				function(data){
					var myjson='';
			        eval('myjson=' + data + ';');
					$("#title").val(myjson['article_title']);
					var columnid = myjson['column_id'];
					$("#column option[value='"+columnid+"']").attr("selected","selected");
					$("#article_pic").attr("src", myjson['article_picture']);
					$("#introduce").val(myjson['article_introduction']);
					editor1.html(myjson['article_content']);
					
		});
	});
	$("a[service='deleteArticle']").click(function(){
		var result = confirm('你确定要删除吗？');
		if(result){
			$.post("index.php?mod=article&act=deleteArticle&articleid=" + $(this).attr("id"),
					function(data){
				if($.trim(data) == "删除成功"){
					alertify.success(data);
					setTimeout('location.href=location.href',1000);
				}else{
					alertify.error(data);
				}
			});
		}
	});
	$("#reset").click(function(){
		var result = confirm('你确定要返回吗？');
		if(result){
			location.href=location.href;
		}
	});
});	
	
</script>
<script type="text/javascript"  src="./public/js/checkjs/uploadarticle.js"></script>
<div class="main" style="margin-top: 3px">
<div class="twovar {if in_array($mod,array('shippingAddress2'))}nothing-twovar{/if}" style="background-color: gray">
  <ul>
  		{foreach $lcolumnlist as $key => $column}
			<li><a style="border-color: gray" href="index.php?mod=article&act=getArticle&columnid={$column.column_id}" {if $columnid== {$column.column_id} }class = "cho"{/if}>{$column.column_name}</a></li>
		{/foreach}
		<li><a id="checkArticle" style="border-color: gray" href="index.php?mod=article&act=getCheckArticle&columnpid={$columnpid}" {if $smarty.get.act == 'getCheckArticle'}class = "cho"{/if}>未审核文章</a></li>
  </ul>
</div>
<div id="dis1">
<table cellspacing="0" width="100%">
	<tr class="title">
			<th>文章ID</th>
			<th>文章标题</th>
			<th>文章作者</th>
			<th>文章图片</th>
			<th>文章导语</th>
			<th>文章添加时间</th>
			<th>文章访问数</th>
			<th>文章点赞/踩数</th>
			<th>文章评论数</th>
			<th colspan="3">操作</th>
			<th><a id="addArticle" href="javascript:void(0)" style="color:blue">添加文章</a></th>
	</tr>
		{foreach $newslist as $key=>$newsinfo}
			<tr id="del{$newsinfo.article_id}">
				<td>{$newsinfo.article_id}</td>
				<td>{$newsinfo.article_title}</td>
				<td>{$newsinfo.article_author}</td>
				<td><img src={$newsinfo.article_picture} width="20px" height="16px"></td>
				<td>{$newsinfo.article_introduction}</td>
				<td>{date("Y-m-d H:i:s",$newsinfo.article_addtime)}</td>
				<td>{$newsinfo.article_views}</td>
				<td>{$newsinfo.article_agree}/{$newsinfo.article_disagree}</td>		
				<td>{$newsinfo.article_comments}</td>
				<td colspan="3">
					<a href="javascript:void(0)" id="{$newsinfo.article_id}" service="updateArticle">编辑<input id="editarticle" type="hidden" value="{$newsinfo.article_id}" /></a>
					<a href="javascript:void(0)" id="{$newsinfo.article_id}" service="deleteArticle">删除</a>
					<a href="index.php?mod=count&act=index&article_id={$newsinfo.article_id}" id="countArticle">统计</a>
				</td>
				<td></td>
			</tr>
		{/foreach}
</table>
<div class="bottomvar">
		<div class="pagination">{$pageStr}</div>
	</div>
</div>
</div>
<div id="dis2" style="display:none">
			<form id="formcontent" method="post" action="index.php?mod=article&act=addarticle" enctype="multipart/form-data">
					<div class = "my_comment" id="formtitle">投递文章</div>
					<div class="line">
						<span class="my_title">标题：</span>
						<span><input class = "my_a_text" type = "text" id="title"  name="articletitle"/></span>
					</div>
					<div class="a_line">
						<span class="my_title">栏目：</span>
						<span>
							<select class="my_select" id="column" name="columnid">
								
							</select>
						</span>
					</div>
					<div class="a_line">
						<span class="my_title">图片：</span>
						<span><input class = "my_b_text" type = "file" id="picture" name="articlepicture" multiple="multiple"></span>
						<!-- <span><input class = "my_a_button" type="button" value="浏览"></span> -->
					</div>
					<div class = "show_pic">
						<img class="my_picture" src="" style="width:160px;height:120px;" id="article_pic"/>
					</div>
					<div class="line">
						<span class="my_title">导语：</span>
						<span><textarea class="my_lead" cols ="83" rows = "3" id="introduce" name="articleintroduction"></textarea></span>
					</div>
					<div class="line">
						<span class="my_title">内容：</span>
						<span style="margin-left:15px;">
							<textarea name="articlecontent" style="width:500px;height:200px;" id="content" ></textarea>
						</span>
					</div>
					<div class="line">
						<input class = "my_b_button" type = "submit" value = "投递" id="uparticle-btn"/>
						<input class = "my_b_button" type = "reset" value = "取消" id="reset"/>
					</div>
					</form>
			</div>
{include file="admintemplate/footer.htm"}
